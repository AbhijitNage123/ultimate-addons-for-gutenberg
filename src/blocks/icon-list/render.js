// Import classes
import classnames from 'classnames';
import { InnerBlocks } from '@wordpress/block-editor';
import React, { useLayoutEffect, useMemo } from 'react';
import styles from './editor.lazy.scss';
import { useDeviceType } from '@Controls/getPreviewType';

const ALLOWED_BLOCKS = [ 'uagb/icon-list-child' ];

const Render = ( props ) => {
	// Add and remove the CSS on the drop and remove of the component.
	useLayoutEffect( () => {
		styles.use();
		return () => {
			styles.unuse();
		};
	}, [] );

	props = props.parentProps;
	const deviceType = useDeviceType();
	const { attributes } = props;

	const {
		isPreview,
		className,
		icon_count,
		block_id,
	} = attributes;

	const getIconTemplate = useMemo( () => {
		const childIconList = [];

		for ( let i = 0; i < icon_count; i++ ) {
			childIconList.push( [ 'uagb/icon-list-child', { id: i + 1 } ] );
		}

		return childIconList;
	}, [ icon_count ] );

	const previewImageData = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMzUwcHgiIGhlaWdodD0iMzUwcHgiIHZpZXdCb3g9IjAgMCAzNTAgMzUwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAzNTAgMzUwIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjREJEQ0RFIiBkPSJNMzAxLjc3MSwxMjcuMzg1YzAsMi43MzctMi4yMTksNC45NTUtNC45NTIsNC45NTVIOTEuNTgxYy0yLjczNCwwLTQuOTUzLTIuMjE4LTQuOTUzLTQuOTU1di0wLjYxOA0KCQkJYzAtMi43MzcsMi4yMTktNC45NTMsNC45NTMtNC45NTNoMjA1LjIzOGMyLjczMywwLDQuOTUyLDIuMjE2LDQuOTUyLDQuOTUzVjEyNy4zODV6Ii8+DQoJCTxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBmaWxsPSIjQkJCREMwIiBkPSJNNzEuMzQyLDEyNy4xYzAuMDMyLDYuMzA5LTUuMTEsMTEuNTI0LTExLjM5MiwxMS41NTINCgkJCWMtNi40NjksMC4wMjktMTEuNjk2LTUuMTA0LTExLjcyMS0xMS41MDljLTAuMDI0LTYuMzQ0LDUuMTcxLTExLjYwNCwxMS40OTctMTEuNjM5QzY2LjE3NCwxMTUuNDY5LDcxLjMwOSwxMjAuNTk1LDcxLjM0MiwxMjcuMXoNCgkJCSBNNjMuMjMxLDEyOC4zNTFjMC4wNDIsMC4wNjIsMC4wODMsMC4xMjMsMC4xMjYsMC4xODZjLTAuNjk0LDAuNjQxLTEuNDA0LDEuMjY0LTIuMDc3LDEuOTI3Yy0wLjQ4OSwwLjQ4My0wLjQ1MywxLjExLDAuMDMxLDEuNTg3DQoJCQljMC40NywwLjQ2NSwxLjEyNSwwLjQ4MywxLjU5NCwwLjAwOGMxLjM2Mi0xLjM3OCwyLjcxNy0yLjc2NCw0LjA2My00LjE1OWMwLjQ4LTAuNDk3LDAuNDgtMS4xNSwwLTEuNjM2DQoJCQljLTEuMzgtMS4zOTYtMi43NjktMi43ODUtNC4xNjUtNC4xNjZjLTAuNDgtMC40NzYtMS4xMjEtMC40NTUtMS41OTIsMC4wMTNjLTAuNDg2LDAuNDgzLTAuNDk2LDEuMTE5LTAuMDA3LDEuNjE5DQoJCQljMC41OSwwLjYwNCwxLjE5NCwxLjE5NywxLjc5LDEuNzk1YzAuMDc0LDAuMDczLDAuMTM4LDAuMTU3LDAuMjQ5LDAuMjg0Yy0wLjE5MSwwLTAuMzEyLDAtMC40MzMsMGMtMS4zNTQsMC0yLjcwOSwwLTQuMDYzLDANCgkJCWMtMS43MDMsMC0zLjQwNS0wLjAwMS01LjEwOCwwLjAwMmMtMC42MywwLjAwMS0xLjExMiwwLjMzNi0xLjI4OSwwLjg4Yy0wLjI3MywwLjg0LDAuMzQ4LDEuNjU2LDEuMjc3LDEuNjU4DQoJCQljMy4wNjksMC4wMDQsNi4xMzgsMC4wMDIsOS4yMDgsMC4wMDJDNjIuOTY3LDEyOC4zNTEsNjMuMDk5LDEyOC4zNTEsNjMuMjMxLDEyOC4zNTF6Ii8+DQoJPC9nPg0KCTxnPg0KCQk8cGF0aCBmaWxsPSIjREJEQ0RFIiBkPSJNMzAxLjc3MSwxNzMuMzU2YzAsMi43MzctMi4yMTksNC45NTUtNC45NTIsNC45NTVIOTEuNTgxYy0yLjczNCwwLTQuOTUzLTIuMjE4LTQuOTUzLTQuOTU1di0wLjYxOA0KCQkJYzAtMi43MzYsMi4yMTktNC45NTMsNC45NTMtNC45NTNoMjA1LjIzOGMyLjczMywwLDQuOTUyLDIuMjE2LDQuOTUyLDQuOTUzVjE3My4zNTZ6Ii8+DQoJCTxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBmaWxsPSIjQkJCREMwIiBkPSJNNzEuMzQyLDE3My4wNzFjMC4wMzIsNi4zMDgtNS4xMSwxMS41MjItMTEuMzkyLDExLjU1MQ0KCQkJYy02LjQ2OSwwLjAyOC0xMS42OTYtNS4xMDQtMTEuNzIxLTExLjUwOWMtMC4wMjQtNi4zNDQsNS4xNzEtMTEuNjA0LDExLjQ5Ny0xMS42MzhDNjYuMTc0LDE2MS40MzksNzEuMzA5LDE2Ni41NjUsNzEuMzQyLDE3My4wNzENCgkJCXogTTYzLjIzMSwxNzQuMzIyYzAuMDQyLDAuMDYxLDAuMDgzLDAuMTIzLDAuMTI2LDAuMTg1Yy0wLjY5NCwwLjY0LTEuNDA0LDEuMjY0LTIuMDc3LDEuOTI3Yy0wLjQ4OSwwLjQ4My0wLjQ1MywxLjExLDAuMDMxLDEuNTg4DQoJCQljMC40NywwLjQ2NSwxLjEyNSwwLjQ4MiwxLjU5NCwwLjAwOGMxLjM2Mi0xLjM3OSwyLjcxNy0yLjc2NCw0LjA2My00LjE1OWMwLjQ4LTAuNDk3LDAuNDgtMS4xNSwwLTEuNjM2DQoJCQljLTEuMzgtMS4zOTYtMi43NjktMi43ODQtNC4xNjUtNC4xNjZjLTAuNDgtMC40NzUtMS4xMjEtMC40NTUtMS41OTIsMC4wMTNjLTAuNDg2LDAuNDgzLTAuNDk2LDEuMTE5LTAuMDA3LDEuNjE5DQoJCQljMC41OSwwLjYwNCwxLjE5NCwxLjE5NiwxLjc5LDEuNzk1YzAuMDc0LDAuMDczLDAuMTM4LDAuMTU3LDAuMjQ5LDAuMjg0Yy0wLjE5MSwwLTAuMzEyLDAtMC40MzMsMGMtMS4zNTQsMC0yLjcwOSwwLTQuMDYzLDANCgkJCWMtMS43MDMsMC0zLjQwNS0wLjAwMi01LjEwOCwwLjAwMWMtMC42MywwLjAwMS0xLjExMiwwLjMzNi0xLjI4OSwwLjg3OWMtMC4yNzMsMC44NCwwLjM0OCwxLjY1NywxLjI3NywxLjY1OA0KCQkJYzMuMDY5LDAuMDA0LDYuMTM4LDAuMDAyLDkuMjA4LDAuMDAzQzYyLjk2NywxNzQuMzIyLDYzLjA5OSwxNzQuMzIyLDYzLjIzMSwxNzQuMzIyeiIvPg0KCTwvZz4NCgk8Zz4NCgkJPHBhdGggZmlsbD0iI0RCRENERSIgZD0iTTMwMS43NzEsMjIzLjIyOWMwLDIuNzM3LTIuMjE5LDQuOTU0LTQuOTUyLDQuOTU0SDkxLjU4MWMtMi43MzQsMC00Ljk1My0yLjIxNy00Ljk1My00Ljk1NHYtMC42MTgNCgkJCWMwLTIuNzM2LDIuMjE5LTQuOTUyLDQuOTUzLTQuOTUyaDIwNS4yMzhjMi43MzMsMCw0Ljk1MiwyLjIxNiw0Ljk1Miw0Ljk1MlYyMjMuMjI5eiIvPg0KCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0JCQkRDMCIgZD0iTTcxLjM0MiwyMjIuOTQ0YzAuMDMyLDYuMzEtNS4xMSwxMS41MjQtMTEuMzkyLDExLjU1Mg0KCQkJYy02LjQ2OSwwLjAyOS0xMS42OTYtNS4xMDQtMTEuNzIxLTExLjUwOWMtMC4wMjQtNi4zNDUsNS4xNzEtMTEuNjA0LDExLjQ5Ny0xMS42NEM2Ni4xNzQsMjExLjMxMyw3MS4zMDksMjE2LjQzOSw3MS4zNDIsMjIyLjk0NHoNCgkJCSBNNjMuMjMxLDIyNC4xOTRjMC4wNDIsMC4wNjMsMC4wODMsMC4xMjQsMC4xMjYsMC4xODZjLTAuNjk0LDAuNjQyLTEuNDA0LDEuMjY1LTIuMDc3LDEuOTI4DQoJCQljLTAuNDg5LDAuNDgzLTAuNDUzLDEuMTExLDAuMDMxLDEuNTg4YzAuNDcsMC40NjQsMS4xMjUsMC40ODEsMS41OTQsMC4wMDljMS4zNjItMS4zNzksMi43MTctMi43NjYsNC4wNjMtNC4xNjENCgkJCWMwLjQ4LTAuNDk2LDAuNDgtMS4xNDksMC0xLjYzNmMtMS4zOC0xLjM5Ni0yLjc2OS0yLjc4NC00LjE2NS00LjE2NWMtMC40OC0wLjQ3Ni0xLjEyMS0wLjQ1NC0xLjU5MiwwLjAxMw0KCQkJYy0wLjQ4NiwwLjQ4Mi0wLjQ5NiwxLjExOS0wLjAwNywxLjYxOWMwLjU5LDAuNjA0LDEuMTk0LDEuMTk2LDEuNzksMS43OTVjMC4wNzQsMC4wNzMsMC4xMzgsMC4xNTYsMC4yNDksMC4yODUNCgkJCWMtMC4xOTEsMC0wLjMxMiwwLTAuNDMzLDBjLTEuMzU0LDAtMi43MDksMC00LjA2MywwYy0xLjcwMywwLTMuNDA1LTAuMDAzLTUuMTA4LDAuMDAxYy0wLjYzLDAuMDAxLTEuMTEyLDAuMzM2LTEuMjg5LDAuODc5DQoJCQljLTAuMjczLDAuODQsMC4zNDgsMS42NTcsMS4yNzcsMS42NThjMy4wNjksMC4wMDYsNi4xMzgsMC4wMDIsOS4yMDgsMC4wMDJDNjIuOTY3LDIyNC4xOTQsNjMuMDk5LDIyNC4xOTQsNjMuMjMxLDIyNC4xOTR6Ii8+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=';

	return (
		isPreview ? <img width='100%' src={previewImageData} alt=''/> :
		<div
			className={ classnames(
				className,
				`uagb-editor-preview-mode-${ deviceType.toLowerCase() }`,
				`uagb-block-${ block_id }`
			) }
		>
			<div className="uagb-icon-list__wrap">
				<InnerBlocks
					template={ getIconTemplate }
					templateLock={ false }
					allowedBlocks={ ALLOWED_BLOCKS }
				/>
			</div>
		</div>
	);
};
export default React.memo( Render );
